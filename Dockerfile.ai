FROM python:3.12-bookworm

# Install FFmpeg for audio processing
RUN apt-get update && apt-get install -y ffmpeg sqlite3 git && rm -rf /var/lib/apt/lists/*
WORKDIR /code

# Copy requirements first for better caching
COPY ./requirements.txt /code/requirements.txt

# Install Python packages
RUN pip install --no-cache-dir --upgrade pip
RUN pip install --no-cache-dir -r /code/requirements.txt

# Install Playwright system dependencies and browsers
RUN playwright install-deps
RUN playwright install chromium

# Configure git for the working directory
RUN git config --global --add safe.directory /code


# Copy the app code (this will be overridden by volume mount in development)
COPY ./app /code/app

